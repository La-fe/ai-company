# 技术架构模式参考手册

> 本文档在 Layer 2（架构研究）时加载。
> 来源: System Design, Software Architecture Patterns, Cloud Architecture
> 层级对应: Layer 2 架构研究

---

## Web 应用架构模式

### 模式分类

| 模式 | 核心思路 | 适用场景 | 复杂度 | 扩展性 |
|------|---------|---------|--------|--------|
| **单体** | 所有功能在一个部署单元 | MVP / 小团队 / 快速验证 | 低 | 低 |
| **模块化单体** | 单体内按领域模块化 | 中等复杂度 / 未来可能拆分 | 中 | 中 |
| **微服务** | 每个服务独立部署 | 大团队 / 高扩展需求 | 高 | 高 |
| **Serverless** | 函数即服务，按调用付费 | 事件驱动 / 流量波动大 | 中 | 高 |
| **Jamstack** | 预渲染 + API + CDN | 内容型网站 / 高性能要求 | 低 | 中 |
| **BFF + 微服务** | 前端专属 API 层 + 后端服务 | 多端（Web/App/API） | 高 | 高 |

### 模式选择决策树

```
项目特点分析:
├── 团队 ≤3 人？
│   ├── 是 → 单体 或 模块化单体
│   └── 否 → 继续评估
├── 需要快速验证？
│   ├── 是 → 单体 + Serverless 辅助
│   └── 否 → 继续评估
├── 流量模式？
│   ├── 稳定 → 单体/微服务
│   ├── 波动大 → Serverless
│   └── 内容为主 → Jamstack
├── 多端需求？
│   ├── 是 → BFF 模式
│   └── 否 → 继续评估
└── 扩展需求？
    ├── 单模块热点 → 模块化单体 + 热点模块拆出
    └── 全局扩展 → 微服务
```

### 各模式 Trade-off 详解

**单体架构**
```
优势:
+ 开发简单，部署简单
+ 调试方便，全链路可追踪
+ 团队沟通成本低
+ 数据一致性容易保证

劣势:
- 单点故障风险
- 扩展只能整体扩展
- 技术栈锁定
- 代码越来越难维护

适合: 0→1 阶段，验证产品市场匹配
```

**Serverless**
```
优势:
+ 按调用付费，零流量零成本
+ 自动扩缩容
+ 无需管理服务器
+ 适合事件驱动场景

劣势:
- 冷启动延迟
- 执行时间限制（通常 15 分钟）
- 调试困难
- 供应商锁定

适合: AI 调用、图片处理、定时任务、Webhook 处理
```

**Jamstack**
```
优势:
+ 极快的页面加载（CDN 边缘）
+ 安全性高（无服务器暴露）
+ 开发体验好
+ 成本低

劣势:
- 动态内容需要 API
- 构建时间随页面增长
- 实时性受限

适合: 内容型网站、博客、落地页、文档站
```

---

## AI 产品常见架构

### AI 集成模式

| 模式 | 核心思路 | 适用场景 | 复杂度 |
|------|---------|---------|--------|
| **AI-as-API** | 调用第三方模型 API | 快速集成 / 非核心 AI | 低 |
| **嵌入式 AI** | AI 嵌入产品核心流程 | AI 是核心价值 | 中 |
| **AI Pipeline** | 多步 AI 编排 | 复杂 AI 工作流 | 高 |
| **AI Agent** | 自主决策的 AI 代理 | 自动化复杂任务 | 高 |
| **RAG** | 检索增强生成 | 知识密集型应用 | 中 |

### AI 架构决策要点

```
AI 架构决策树:
├── AI 是核心价值还是增强功能？
│   ├── 核心 → 嵌入式 AI 或 AI Pipeline
│   └── 增强 → AI-as-API
├── 需要多步 AI 处理？
│   ├── 是 → AI Pipeline
│   └── 否 → 单次 API 调用
├── 需要自主决策？
│   ├── 是 → AI Agent
│   └── 否 → 确定性 Pipeline
├── 需要私有知识？
│   ├── 是 → RAG
│   └── 否 → 直接生成
└── 延迟要求？
    ├── 实时（<2s）→ 流式输出 + 小模型
    ├── 准实时（<10s）→ 标准模型
    └── 离线 → 异步队列 + 大模型
```

---

## 搜索策略

### 如何针对不同类型的技术问题构造搜索关键词

| 场景 | 搜索关键词模板 | 说明 |
|------|--------------|------|
| 了解产品技术栈 | `"{产品名} tech stack"` | 直接搜产品用了什么 |
| 了解架构模式 | `"{产品类型} architecture patterns"` | 这类产品的通用架构 |
| 寻找开源方案 | `"{功能} open source github"` | 找可复用的开源项目 |
| 技术选型对比 | `"{技术A} vs {技术B} {场景} {年份}"` | 对比特定技术在特定场景 |
| 最佳实践 | `"{技术栈} best practices {年份}"` | 获取最新最佳实践 |
| 性能基准 | `"{技术} benchmark {场景}"` | 性能对比数据 |
| 工程博客 | `"{公司名} engineering blog"` | 了解大厂架构决策 |
| 招聘信息反推技术栈 | `"{公司名} careers engineer"` | 从招聘 JD 推技术栈 |

### 竞品技术栈推断方法

从外部可观察信号推断技术栈：

| 信号 | 检查方法 | 能推断什么 |
|------|---------|-----------|
| HTML meta 标签 | 查看页面源码 | 前端框架（Next.js 有 `__NEXT_DATA__`） |
| Network 请求 | 浏览器 DevTools | API 风格、CDN、第三方服务 |
| 响应 Header | `server`, `x-powered-by` | 服务器/框架 |
| JS Bundle | 源码关键词 | React/Vue/Angular 等 |
| DNS/CNAME | `dig` 或在线工具 | 托管服务商（Vercel/AWS/Cloudflare） |
| SSL 证书 | 证书信息 | CDN 提供商 |
| 错误页面 | 触发 404/500 | 后端框架特征 |
| 招聘页面 | 职位描述中的技术关键词 | 完整技术栈 |
| 技术博客 | 工程团队分享 | 架构决策、技术选型理由 |

---

## 架构模式比较模板

用于输出时的标准化比较表：

```markdown
### 架构模式比较

| 维度 | 模式A | 模式B | 模式C |
|------|-------|-------|-------|
| 核心思路 | {一句话} | {一句话} | {一句话} |
| 适用场景 | {场景} | {场景} | {场景} |
| 开发复杂度 | 低/中/高 | 低/中/高 | 低/中/高 |
| 运维复杂度 | 低/中/高 | 低/中/高 | 低/中/高 |
| 扩展性 | 低/中/高 | 低/中/高 | 低/中/高 |
| 初期成本 | {估算} | {估算} | {估算} |
| 规模化成本 | {估算} | {估算} | {估算} |
| 团队要求 | {人数/技能} | {人数/技能} | {人数/技能} |
| 代表产品 | {产品} | {产品} | {产品} |
| 与项目匹配度 | 高/中/低 | 高/中/低 | 高/中/低 |
| 匹配理由 | {为什么} | {为什么} | {为什么} |
```
